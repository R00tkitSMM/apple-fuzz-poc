## CVE-2021-21987-vmware-out-of-bounds read vulnerability via Cortado ThinPrint

This vulnerability can be reproduced on windows 10 with VMware Workstation 16.1.0 Pro installed. First you need to turn on Virtual Printer which is not enabled by default.

![](https://z3.ax1x.com/2021/05/21/gHiOiD.png)

And you need to install Virtual Printer on guest machine. 

![](https://z3.ax1x.com/2021/05/21/gHFmyn.png)

Then you can use printers on host machine to print document on guest machine. The data processing is in TPView.dll, TPview.dll will run in rundll32.exe. Install python3 on guest machine and run command: "python poc.py". Then rundll32.exe will crash and you can find a .dmp file. 

![](https://z3.ax1x.com/2021/05/21/gHFJSJ.png)

If you set windbg as default postmortem debugger then windbg will catch this. 

![](https://z3.ax1x.com/2021/05/21/gHFwTK.png)

It seems to me this is because tpview.dll trust data in ttf file and read invalid memory. The poc is slightly modified from google project zero: https://bugs.chromium.org/p/project-zero/issues/detail?id=849
